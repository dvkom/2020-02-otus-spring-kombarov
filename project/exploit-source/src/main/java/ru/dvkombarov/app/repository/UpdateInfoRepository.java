package ru.dvkombarov.app.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.data.rest.core.annotation.RepositoryRestResource;
import ru.dvkombarov.app.constants.SourceType;
import ru.dvkombarov.app.constants.UpdateStatus;
import ru.dvkombarov.app.domain.UpdateInfo;

import java.time.LocalDate;
import java.util.Optional;

@RepositoryRestResource(exported = false)
public interface UpdateInfoRepository extends JpaRepository<UpdateInfo, Long> {

  @Query("select max(u.updateDateTime) from UpdateInfo u " +
      "where u.sourceType = :sourceType and u.updateStatus = :updateStatus")
  Optional<LocalDate> getLastUpdateDateTime(@Param("sourceType") SourceType sourceType,
                                            @Param("updateStatus") UpdateStatus updateStatus);
}
